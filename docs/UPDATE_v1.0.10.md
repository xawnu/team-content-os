# v1.0.10 更新说明

## 🎉 新功能：参考视频池可视化升级

### 主要改进

1. **可视化视频卡片**
   - 自动显示视频缩略图、标题、时长、频道名
   - 替代原来的纯文本输入框
   - 更直观的视频信息预览

2. **拖拽排序**
   - 支持鼠标拖拽调整视频顺序
   - 顺序影响生成权重（排在前面的视频权重更高）
   - 流畅的拖拽动画效果

3. **快速删除**
   - 每个视频卡片右上角有删除按钮
   - 鼠标悬停时显示，点击即可删除
   - 无需手动编辑文本

4. **自动解析视频信息**
   - 粘贴 YouTube 链接后自动获取视频元信息
   - 支持多种链接格式：
     - `https://youtube.com/watch?v=...`
     - `https://youtu.be/...`
     - `https://youtube.com/embed/...`
   - 自动去重（不允许添加重复视频）

5. **智能提示**
   - 显示当前视频数量和最大限制（x/3）
   - 空状态时显示友好的引导界面
   - 错误提示清晰明确

### 技术实现

- 新增 API 路由：`/api/youtube/video-info`
  - 自动解析 YouTube 视频 ID
  - 调用 YouTube Data API v3 获取视频信息
  - 支持多 Key 轮询（配额保护）

- 新增组件：`ReferenceVideoPool.tsx`
  - 使用 `@dnd-kit` 实现拖拽功能
  - 响应式设计，移动端友好
  - 自动保存到 localStorage

- 更新页面：`/planner/page.tsx`
  - 集成新的可视化组件
  - 保持原有功能逻辑不变
  - 向后兼容旧的文本格式

### 用户体验提升

**之前：**
```
参考视频池（每行1条，先从发现页加入，最多3条）
┌─────────────────────────────────────────────┐
│ Rain Sounds - https://youtube.com/...      │
│ Sleep Music - https://youtu.be/...         │
│                                             │
└─────────────────────────────────────────────┘
```

**现在：**
```
参考视频池（2/3） 拖拽调整顺序，顺序影响生成权重
┌─────────────────────────────────────────────┐
│ ≡ [缩略图] Rain Sounds for Sleep            │
│           Deep Sleep Channel · 10:23     [×]│
│           在 YouTube 查看 →                  │
├─────────────────────────────────────────────┤
│ ≡ [缩略图] Relaxing Music for Meditation    │
│           Calm Music · 15:42             [×]│
│           在 YouTube 查看 →                  │
└─────────────────────────────────────────────┘
[输入框：粘贴 YouTube 视频链接] [添加]
```

### 配置要求

需要在 `.env.local` 中配置 YouTube API Key：

```bash
# 单 Key
YOUTUBE_API_KEY=your_key

# 或多 Key 轮询（推荐）
YOUTUBE_API_KEYS=key1,key2,key3
```

### 向后兼容

- 旧的 localStorage 数据会自动迁移
- 保存的主题参考池格式已更新
- 原有的生成逻辑完全兼容

### 下一步优化

- [ ] 支持从发现页/同类页一键添加到参考池
- [ ] 支持批量导入（粘贴多个链接）
- [ ] 增加视频预览功能（点击缩略图播放）
- [ ] 支持自定义视频权重（不仅靠顺序）

---

**部署说明：**

1. 安装新依赖：`npm install`
2. 配置 YouTube API Key
3. 重新构建：`npm run build`
4. 重启服务：`pm2 restart team-content-os`
