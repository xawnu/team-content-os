# v1.0.19 更新说明

## 📜 新功能：版本历史和对比

### 主要改进

1. **版本历史管理**
   - 自动保存每次生成的版本（最多 10 个）
   - 显示版本号、标题、评分、生成时间
   - 显示配置信息（内容目的、叙事结构、语气）
   - 支持展开查看详细内容

2. **版本对比功能**
   - 选择 2 个版本进行对比
   - 并排显示差异（高亮不同部分）
   - 对比基本信息、详细脚本、评分
   - 可视化差异标记

3. **快速恢复**
   - 一键恢复历史版本
   - 自动填充配置参数
   - 滚动到顶部查看

4. **版本标记**
   - 最新版本标记
   - 评分颜色编码（优秀/良好/及格/待改进）
   - 配置标签显示

### 使用场景

**场景 1：查看版本历史**
```
生成文案后 → 点击「版本历史」按钮
→ 查看所有历史版本
→ 了解不同版本的差异
```

**场景 2：对比版本**
```
版本历史 → 勾选 2 个版本
→ 点击「对比版本」
→ 并排查看差异
→ 选择最佳版本
```

**场景 3：恢复历史版本**
```
版本历史 → 找到满意的版本
→ 点击「恢复此版本」
→ 自动填充到当前页面
→ 继续编辑或使用
```

**场景 4：迭代优化**
```
生成版本 A → 不满意
→ 点击「再来一版」→ 生成版本 B
→ 对比 A 和 B
→ 选择更好的版本
```

### 功能详解

**版本历史界面：**

```
┌─────────────────────────────────────┐
│ 版本历史                [关闭]     │
├─────────────────────────────────────┤
│ □ 版本 3 [最新] [评分: 85]         │
│   标题：如何养鸡...                 │
│   时间：2024-02-23 15:30           │
│   [拉新破圈] [问题→方案→结果]      │
│   [展开详情] [恢复此版本]          │
├─────────────────────────────────────┤
│ □ 版本 2 [评分: 78]                │
│   标题：养鸡技巧...                 │
│   时间：2024-02-23 15:25           │
│   [展开详情] [恢复此版本]          │
└─────────────────────────────────────┘
```

**版本对比界面：**

```
┌─────────────────────────────────────┐
│ 版本对比                [关闭]     │
├──────────────┬──────────────────────┤
│ 版本 A       │ 版本 B               │
│ 评分: 85     │ 评分: 78             │
├──────────────┼──────────────────────┤
│ 主题：养鸡   │ 主题：养鸡           │
│ 标题：如何... │ 标题：养鸡技巧...    │
│ [差异高亮]   │ [差异高亮]           │
└──────────────┴──────────────────────┘
```

### 技术实现

**版本保存：**
```javascript
const newVersion = {
  id: Date.now().toString(),
  topic: script.topic,
  title: script.title,
  createdAt: new Date().toISOString(),
  score: qualityScore.overall,
  scriptOutline: config,
  detailedScript: script,
  config: { contentGoal, narrativeStructure, toneStyle },
};
setScriptVersions(prev => [newVersion, ...prev].slice(0, 10));
```

**版本对比：**
```javascript
function renderField(label, value1, value2) {
  const isDifferent = JSON.stringify(value1) !== JSON.stringify(value2);
  return (
    <div className={isDifferent ? 'bg-yellow-50 border-yellow-200' : 'bg-zinc-50'}>
      {/* 并排显示 */}
    </div>
  );
}
```

### 工作流优化

**之前的流程：**
1. 生成文案
2. 不满意
3. 重新生成
4. 忘记之前的版本
5. 无法对比

**现在的流程：**
1. 生成文案 → 自动保存为版本 1
2. 不满意 → 点击「再来一版」
3. 生成版本 2 → 自动保存
4. 点击「版本历史」→ 查看所有版本
5. 选择 2 个版本 → 对比差异
6. 选择最佳版本 → 恢复使用

**效率提升：**
- 不再丢失历史版本
- 快速对比多个版本
- 一键恢复满意的版本
- 支持迭代优化

### 版本管理策略

**保存策略：**
- 最多保留 10 个版本
- 超过 10 个自动删除最旧的
- 每次生成自动保存

**版本信息：**
- 版本号（倒序）
- 生成时间
- 质量评分
- 配置参数

**对比策略：**
- 最多选择 2 个版本
- 高亮显示差异
- 支持所有字段对比

### 后续优化方向

1. **版本标签**
   - 为版本添加自定义标签
   - 标记"最佳版本"
   - 添加备注说明

2. **版本导出**
   - 导出单个版本为 JSON
   - 批量导出多个版本
   - 导入历史版本

3. **版本评分**
   - 手动调整版本评分
   - 添加自定义评分维度
   - 版本排行榜

4. **版本持久化**
   - 保存到数据库
   - 跨设备同步
   - 团队共享版本

---

**部署说明：**

1. 拉取最新代码：`git pull origin master`
2. 重新构建：`npm run build`
3. 重启服务：`pm2 restart youtube.9180.net`

**兼容性：**
- 向后兼容，无破坏性变更
- 版本历史存储在内存中（刷新页面会清空）
- 未来可升级为持久化存储
